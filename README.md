# TrajGen: Generating Realistic and Diverse Trajectories With Reactive and Feasible Agent Behaviors for Autonomous Driving
Implementation of the [TrajGen][website_arxiv] and I-SIM simulator based on [Interaction Dataset][website_INTER]. TrajGen is a two-stage trajectory generation framework, which can capture realistic and diverse behaviors directly from human demonstration.

[website_arxiv]: https://sites.google.com/view/trajgen/
[website_INTER]: http://www.interaction-dataset.com/

<img width="48%" src="https://github.com/gaoyinfeng/TrajGen/blob/main/gif/trajgen_1.gif"> <img width="48%" src="https://github.com/gaoyinfeng/TrajGen/blob/main/gif/trajgen_2.gif">

- [Project website](https://sites.google.com/view/trajgen/)
- [Research paper](https://arxiv.org/pdf/2203.16792.pdf)

If you find this code useful, please reference in your paper:

```
@article{zhang2022trajgen,
  title={TrajGen: Generating Realistic and Diverse Trajectories With Reactive and Feasible Agent Behaviors for Autonomous Driving},
  author={Zhang, Qichao and Gao, Yinfeng and Zhang, Yikang and Guo, Youtian and Ding, Dawei and Wang, Yunpeng and Sun, Peng and Zhao, Dongbin},
  journal={IEEE Transactions on Intelligent Transportation Systems},
  year={2022},
  doi={10.1109/TITS.2022.3202185}
}
```

## Manual Instructions
To properly run TrajGen on your system, you should clone this repository, and follow the instruction below to install the dependencies for both I-SIM and TrajGen.
### 1. Dependencies for I-SIM simulator
Since the HD maps of Interaction Dataset uses the format of Lanelet2, you need to build Lanelet2 Docker first, we provide a modified version of [Lanelet2][website_lanelet2] in our repo:
```sh
cd Lanelet2
docker build -t isim .
```
[website_lanelet2]: https://github.com/fzi-forschungszentrum-informatik/Lanelet2

After build, run docker container and do port mapping, we use port 5557-5561 as example:
```sh
docker run -it -e DISPLAY -p 5557-5561:5557-5561 -v $path for TrajGen$:/home/developer/workspace/interaction-dataset-master -v /tmp/.X11-unix:/tmp/.X11-unix --user="$(id --user):$(id --group)" --name isim57 isim:latest bash
```
Update dependencies:
```sh
sudo apt update
sudo apt install python-tk
```
Check wheather I-SIM can properly run:
```sh
cd interaction-dataset-master/python/interaction_gym/
python main_visualize_data.py "DR_USA_Intersection_EP0"
```

### 2. Dependencies for TrajGen
TrajGen requires python3(>=3.7) and tensorflow-gpu(>=1.14), as for other packages, please run:
```sh
pip install -r requirements.txt
```

## Usage
This repo has contained predicted trajcetories generated by LaneGCN with Routeloss, which is the first stage of TrajGen framework. If you want to further understand how this work, please check [LaneGCN with Routeloss][website_routeloss]. We also provide a pretrained model for testing.

[website_routeloss]: https://github.com/YikangZhang1641/modified_LaneGCN

### Qucik Start
To train or test TrajGen, your have to run I-SIM manually, we assume that I-SIM runs at port 5557 inside a docker container:
```sh
docker exec -it isim57 bash
cd interaction-dataset-master/python/interaction_gym/
python interaction_env.py --port=5557
```
Train TrajGen:
```sh
python python/interaction_rl/main.py --port=5557
```
Visualize training curves:
```sh
python python/interaction_rl/results/rl/$ports$/visualize_results.py
```
Test TrajGen:
```sh
python python/interaction_rl/main.py --port=5557 --test
```
Print test results:
```sh
python python/interaction_rl/results/test/print_results.py

```


## Citation
If you find TrajGen useful in your research or applications, please consider giving us a star &#127775; and citing it by the following BibTeX entry.

```BibTeX
@article{zhang2022trajgen,
  author={Zhang, Qichao and Gao, Yinfeng and Zhang, Yikang and Guo, Youtian and Ding, Dawei and Wang, Yunpeng and Sun, Peng and Zhao, Dongbin},
  journal={IEEE Transactions on Intelligent Transportation Systems}, 
  title={TrajGen: Generating Realistic and Diverse Trajectories With Reactive and Feasible Agent Behaviors for Autonomous Driving}, 
  year={2022},
  volume={23},
  number={12},
  pages={24474-24487},
  doi={10.1109/TITS.2022.3202185}}
```


## Acknowledgement
We appreciate the following github repos for their valuable code base or dataset:

https://github.com/fzi-forschungszentrum-informatik/Lanelet2

https://github.com/interaction-dataset/interaction-dataset

